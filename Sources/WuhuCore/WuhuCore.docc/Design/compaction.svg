<svg xmlns="http://www.w3.org/2000/svg" width="780" height="330" viewBox="0 0 780 330">
  <style>
    text { font-family: ui-monospace, 'SF Mono', Menlo, monospace; }
    .title { font-size: 12px; font-weight: 600; fill: #1a1a1a; }
    .label { font-size: 9px; fill: #444; }
    .side { font-size: 10px; fill: #888; }
    .annot { font-size: 10px; fill: #666; }
    .box { rx: 3; ry: 3; stroke-width: 1; }
    .kept { fill: #dbe9f4; stroke: #7ba7cc; }
    .tosum { fill: #fde8c8; stroke: #e0b87a; }
    .sum { fill: #d4edda; stroke: #82c091; }
    .sys { fill: #e8e0f0; stroke: #a890c0; }
    .bracket { fill: none; stroke: #999; stroke-width: 1; }
    .arrow-down { fill: #999; }
  </style>

  <!-- ═══════════════ FIRST COMPACTION ═══════════════ -->
  <text x="16" y="16" class="title">First compaction</text>

  <!-- Before -->
  <text x="16" y="42" class="side">before</text>
  <g transform="translate(64, 28)">
    <rect class="box sys"   x="0"   y="0" width="58" height="28"/>
    <text class="label" x="29"  y="18" text-anchor="middle">system</text>

    <rect class="box tosum" x="62"  y="0" width="58" height="28"/>
    <text class="label" x="91"  y="18" text-anchor="middle">usr</text>
    <rect class="box tosum" x="124" y="0" width="58" height="28"/>
    <text class="label" x="153" y="18" text-anchor="middle">ast</text>
    <rect class="box tosum" x="186" y="0" width="58" height="28"/>
    <text class="label" x="215" y="18" text-anchor="middle">tool</text>

    <rect class="box kept"  x="248" y="0" width="58" height="28"/>
    <text class="label" x="277" y="18" text-anchor="middle">usr</text>
    <rect class="box kept"  x="310" y="0" width="58" height="28"/>
    <text class="label" x="339" y="18" text-anchor="middle">ast</text>
    <rect class="box kept"  x="372" y="0" width="58" height="28"/>
    <text class="label" x="401" y="18" text-anchor="middle">tool</text>
    <rect class="box kept"  x="434" y="0" width="58" height="28"/>
    <text class="label" x="463" y="18" text-anchor="middle">usr</text>
    <rect class="box kept"  x="496" y="0" width="58" height="28"/>
    <text class="label" x="525" y="18" text-anchor="middle">ast</text>
    <rect class="box kept"  x="558" y="0" width="58" height="28"/>
    <text class="label" x="587" y="18" text-anchor="middle">tool</text>

    <!-- Brackets -->
    <path class="bracket" d="M 62,32 L 62,38 L 244,38 L 244,32"/>
    <text class="annot" x="153" y="50" text-anchor="middle">to summarize</text>

    <path class="bracket" d="M 248,32 L 248,38 L 616,38 L 616,32"/>
    <text class="annot" x="432" y="50" text-anchor="middle">kept</text>
  </g>

  <!-- Down arrow -->
  <polygon class="arrow-down" points="370,82 376,82 373,90"/>

  <!-- After -->
  <text x="16" y="106" class="side">after</text>
  <g transform="translate(64, 92)">
    <rect class="box sys"  x="0"   y="0" width="58" height="28"/>
    <text class="label" x="29"  y="18" text-anchor="middle">system</text>
    <rect class="box sum"  x="62"  y="0" width="58" height="28"/>
    <text class="label" x="91"  y="18" text-anchor="middle">sum&#x2081;</text>
    <rect class="box kept" x="124" y="0" width="58" height="28"/>
    <text class="label" x="153" y="18" text-anchor="middle">usr</text>
    <rect class="box kept" x="186" y="0" width="58" height="28"/>
    <text class="label" x="215" y="18" text-anchor="middle">ast</text>
    <rect class="box kept" x="248" y="0" width="58" height="28"/>
    <text class="label" x="277" y="18" text-anchor="middle">tool</text>
    <rect class="box kept" x="310" y="0" width="58" height="28"/>
    <text class="label" x="339" y="18" text-anchor="middle">usr</text>
    <rect class="box kept" x="372" y="0" width="58" height="28"/>
    <text class="label" x="401" y="18" text-anchor="middle">ast</text>
    <rect class="box kept" x="434" y="0" width="58" height="28"/>
    <text class="label" x="463" y="18" text-anchor="middle">tool</text>
  </g>

  <!-- Separator -->
  <line x1="16" y1="140" x2="764" y2="140" stroke="#ddd" stroke-width="1"/>

  <!-- ═══════════════ SECOND COMPACTION ═══════════════ -->
  <text x="16" y="158" class="title">Second compaction</text>

  <!-- Before (starts from the "after" of first compaction) -->
  <text x="16" y="184" class="side">before</text>
  <g transform="translate(64, 170)">
    <rect class="box sys"   x="0"   y="0" width="58" height="28"/>
    <text class="label" x="29"  y="18" text-anchor="middle">system</text>
    <rect class="box sum"   x="62"  y="0" width="58" height="28"/>
    <text class="label" x="91"  y="18" text-anchor="middle">sum&#x2081;</text>

    <rect class="box tosum" x="124" y="0" width="58" height="28"/>
    <text class="label" x="153" y="18" text-anchor="middle">usr</text>
    <rect class="box tosum" x="186" y="0" width="58" height="28"/>
    <text class="label" x="215" y="18" text-anchor="middle">ast</text>
    <rect class="box tosum" x="248" y="0" width="58" height="28"/>
    <text class="label" x="277" y="18" text-anchor="middle">tool</text>

    <rect class="box kept"  x="310" y="0" width="58" height="28"/>
    <text class="label" x="339" y="18" text-anchor="middle">usr</text>
    <rect class="box kept"  x="372" y="0" width="58" height="28"/>
    <text class="label" x="401" y="18" text-anchor="middle">ast</text>
    <rect class="box kept"  x="434" y="0" width="58" height="28"/>
    <text class="label" x="463" y="18" text-anchor="middle">tool</text>

    <!-- Brackets -->
    <path class="bracket" d="M 124,32 L 124,38 L 306,38 L 306,32"/>
    <text class="annot" x="215" y="50" text-anchor="middle">to summarize</text>

    <path class="bracket" d="M 310,32 L 310,38 L 492,38 L 492,32"/>
    <text class="annot" x="401" y="50" text-anchor="middle">kept</text>
  </g>

  <!-- Down arrow -->
  <polygon class="arrow-down" points="370,224 376,224 373,232"/>

  <!-- After -->
  <text x="16" y="248" class="side">after</text>
  <g transform="translate(64, 234)">
    <rect class="box sys"  x="0"   y="0" width="58" height="28"/>
    <text class="label" x="29"  y="18" text-anchor="middle">system</text>
    <rect class="box sum"  x="62"  y="0" width="58" height="28"/>
    <text class="label" x="91"  y="18" text-anchor="middle">sum&#x2081;</text>
    <rect class="box sum"  x="124" y="0" width="58" height="28"/>
    <text class="label" x="153" y="18" text-anchor="middle">sum&#x2082;</text>
    <rect class="box kept" x="186" y="0" width="58" height="28"/>
    <text class="label" x="215" y="18" text-anchor="middle">usr</text>
    <rect class="box kept" x="248" y="0" width="58" height="28"/>
    <text class="label" x="277" y="18" text-anchor="middle">ast</text>
    <rect class="box kept" x="310" y="0" width="58" height="28"/>
    <text class="label" x="339" y="18" text-anchor="middle">tool</text>
  </g>

  <text x="64" y="284" class="annot">Each compaction summarizes from the previous cut point to the new one. Summaries stack.</text>
</svg>
